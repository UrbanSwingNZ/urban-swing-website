<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Urban Swing Student Portal</title>
    <link rel="stylesheet" href="css/base/variables.css">
    <link rel="stylesheet" href="css/base/reset.css">
    <link rel="stylesheet" href="css/base/typography.css">
    <link rel="stylesheet" href="css/registration-form.css">
    <link rel="stylesheet" href="../styles/date-picker/date-picker.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="icon" href="/images/icons/favicon.ico" type="image/x-icon">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
        <p>Processing registration...</p>
    </div>

    <!-- Main Container -->
    <div class="register-container">
        <div class="register-card">
            <a href="index.html" title="Back to Login">
                <img src="/images/urban-swing-logo.png" alt="Urban Swing Logo" class="logo">
            </a>
            <h1>Student Registration</h1>
            <p class="subtitle">Join the Urban Swing community</p>

            <!-- Registration Form -->
            <form id="registration-form" class="registration-form" autocomplete="off">
                <!-- First Name -->
                <div class="form-group">
                    <label for="firstName">
                        <i class="fas fa-user"></i> First Name <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="firstName" 
                        name="firstName" 
                        placeholder="Enter your first name" 
                        required
                        autocomplete="off"
                    >
                </div>

                <!-- Last Name -->
                <div class="form-group">
                    <label for="lastName">
                        <i class="fas fa-user"></i> Last Name <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="lastName" 
                        name="lastName" 
                        placeholder="Enter your last name" 
                        required
                        autocomplete="off"
                    >
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label for="email">
                        <i class="fas fa-envelope"></i> Email Address <span class="required">*</span>
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        placeholder="your.email@example.com" 
                        required
                        autocomplete="off"
                    >
                </div>

                <!-- Phone Number -->
                <div class="form-group">
                    <label for="phoneNumber">
                        <i class="fas fa-phone"></i> Phone Number <span class="required">*</span>
                    </label>
                    <input 
                        type="tel" 
                        id="phoneNumber" 
                        name="phoneNumber" 
                        placeholder="021 123 4567" 
                        required
                        autocomplete="off"
                    >
                </div>

                <!-- Pronouns -->
                <div class="form-group">
                    <label for="pronouns">
                        <i class="fas fa-id-badge"></i> Pronouns
                    </label>
                    <select 
                        id="pronouns" 
                        name="pronouns"
                        autocomplete="off"
                    >
                        <option value="">Select pronouns (optional)</option>
                        <option value="she/her">she/her</option>
                        <option value="he/him">he/him</option>
                        <option value="they/them">they/them</option>
                    </select>
                    <small class="form-help">Optional - helps us address you correctly</small>
                </div>

                <!-- Create Portal Account Checkbox (Only visible to public users) -->
                <div class="form-group checkbox-group public-only" id="create-portal-account-group" style="display: none;">
                    <label class="checkbox-label">
                        <input 
                            type="checkbox" 
                            id="createPortalAccount" 
                            name="createPortalAccount"
                        >
                        <span>
                            <i class="fas fa-user-circle"></i> Create a student portal account
                        </span>
                    </label>
                    <div class="portal-info">
                        <p><strong>What is the student portal?</strong></p>
                        <p>The student portal allows you to:</p>
                        <ul>
                            <li><i class="fas fa-calendar-check"></i> View your class check-ins and attendance history</li>
                            <li><i class="fas fa-ticket-alt"></i> Manage your concessions and class packages</li>
                            <li><i class="fas fa-credit-card"></i> Pre-pay for upcoming classes</li>
                            <li><i class="fas fa-receipt"></i> Access your transaction history and receipts</li>
                            <li><i class="fas fa-user-edit"></i> Update your profile information</li>
                        </ul>
                        <p class="portal-info-note"><i class="fas fa-info-circle"></i> You can always create a portal account later if you prefer.</p>
                    </div>
                </div>

                <!-- Password Section -->
                <div class="password-section accordion-section">
                    <h3 class="accordion-header">
                        <span><i class="fas fa-lock"></i> Create Password</span>
                        <i class="fas fa-chevron-down accordion-icon"></i>
                    </h3>
                    <div class="accordion-content">
                    
                    <!-- Password -->
                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-key"></i> Password
                        </label>
                        <div class="password-input-wrapper">
                            <input 
                                type="password" 
                                id="password" 
                                name="password" 
                                placeholder="At least 8 characters" 
                                autocomplete="new-password"
                            >
                            <button type="button" class="password-toggle" id="password-toggle" aria-label="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="form-help">Minimum 8 characters with uppercase and lowercase letters</small>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group">
                        <label for="confirmPassword">
                            <i class="fas fa-key"></i> Confirm Password
                        </label>
                        <div class="password-input-wrapper">
                            <input 
                                type="password" 
                                id="confirmPassword" 
                                name="confirmPassword" 
                                placeholder="Re-enter your password" 
                                autocomplete="new-password"
                            >
                            <button type="button" class="password-toggle" id="confirm-password-toggle" aria-label="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="form-help">Leave blank if you don't want to create a student portal account yet</small>
                    </div>

                    <!-- Generate Password Helper -->
                    <div class="password-generator-helper">
                        <p class="helper-text">
                            <i class="fas fa-lightbulb"></i> 
                            Need help creating a password? 
                            <button type="button" class="btn-link" id="generate-password-btn">
                                Generate one here
                            </button>
                        </p>
                    </div>

                    <!-- Generated Password Display (hidden by default) -->
                    <div id="generated-password-display" class="generated-password" style="display: none;">
                        <div class="generated-password-content">
                            <span class="generated-password-label">Your Generated Password:</span>
                            <div class="generated-password-value-wrapper">
                                <span id="generated-password-value" class="generated-password-value"></span>
                                <button type="button" class="btn-copy" id="copy-password-btn" title="Copy password">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <small class="form-help">Save this password somewhere safe!</small>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Age Confirmation -->
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input 
                            type="checkbox" 
                            id="over16Confirmed" 
                            name="over16Confirmed" 
                            required
                        >
                        <span>
                            I confirm I am 16 years or older <span class="required">*</span>
                        </span>
                    </label>
                </div>

                <!-- Terms and Conditions -->
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input 
                            type="checkbox" 
                            id="termsAccepted" 
                            name="termsAccepted" 
                            required
                        >
                        <span>
                            I accept the <a href="#" id="terms-link" class="terms-link">Terms and Conditions</a> <span class="required">*</span>
                        </span>
                    </label>
                </div>

                <!-- Email Consent (Hidden - defaults to true) -->
                <div class="form-group checkbox-group" style="display: none;">
                    <label class="checkbox-label">
                        <input 
                            type="checkbox" 
                            id="emailConsent" 
                            name="emailConsent"
                            checked
                        >
                        <span>
                            <i class="fas fa-envelope-open-text"></i> 
                            I'd like to receive updates and news from Urban Swing
                        </span>
                    </label>
                    <small class="form-help">We'll only send occasional updates about classes and events</small>
                </div>

                <!-- Admin Notes (Only visible to admins) -->
                <div class="form-group admin-only" id="admin-notes-group" style="display: none;">
                    <label for="adminNotes">
                        <i class="fas fa-sticky-note"></i> Admin Notes
                    </label>
                    <textarea 
                        id="adminNotes" 
                        name="adminNotes" 
                        rows="3"
                        placeholder="Internal notes (only visible to admin)"
                    ></textarea>
                </div>

                <!-- Payment Section -->
                <div class="payment-section accordion-section">
                    <h3 class="accordion-header">
                        <span><i class="fas fa-credit-card"></i> Payment Information</span>
                        <i class="fas fa-chevron-down accordion-icon"></i>
                    </h3>
                    <div class="accordion-content">
                    
                    <!-- Payment Option Selection -->
                    <div class="form-group">
                        <label style="margin-bottom: 12px;">
                            Select Payment Option <span class="required">*</span>
                        </label>
                        <div class="rate-options" id="rate-options">
                            <!-- Casual rates will be loaded dynamically from Firestore -->
                            <div class="loading-rates">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Loading payment options...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Date Picker for First Class -->
                    <div class="form-group">
                        <label for="first-class-date">
                            <i class="fas fa-calendar"></i> First Class Date <span class="required">*</span>
                        </label>
                        <div class="date-input-wrapper">
                            <input 
                                type="text" 
                                id="first-class-date" 
                                name="firstClassDate" 
                                readonly 
                                placeholder="Select your first class date" 
                                required
                            >
                            <i class="fas fa-calendar-alt date-input-icon"></i>
                        </div>
                        <div id="first-class-calendar" class="custom-calendar" style="display: none;"></div>
                        <small class="form-help">Select the Thursday you plan to attend your first class</small>
                    </div>
                    
                    <!-- Stripe Card Element -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-credit-card"></i> Card Details <span class="required">*</span>
                        </label>
                        <div id="card-element" class="stripe-card-element">
                            <!-- Stripe will inject card input here -->
                        </div>
                        <div id="card-errors" class="error-message" style="display: none;"></div>
                    </div>

                    <div class="payment-notice">
                        <i class="fas fa-shield-alt"></i>
                        <span>Your payment information is secure and encrypted. Powered by Stripe.</span>
                    </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn-primary btn-submit" id="submit-btn">
                    <i class="fas fa-paper-plane"></i> Complete Registration & Pay
                </button>

                <!-- Messages -->
                <div id="success-message" class="success-message" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <span>Registration successful! Welcome to Urban Swing!</span>
                </div>
                <div id="error-message" class="error-message" style="display: none;"></div>
            </form>

            <!-- Back to Login Link -->
            <div style="text-align: center; margin-top: 20px;">
                <a href="index.html" class="back-link" id="back-to-login">
                    <i class="fas fa-arrow-left"></i> Back to Login
                </a>
            </div>

            <!-- Back to Admin Links (Only for admins) -->
            <div class="admin-only" id="back-to-admin" style="display: none; text-align: center; margin-top: 20px;">
                <a href="../admin/student-database/index.html" class="back-link" style="margin-right: 20px;">
                    <i class="fas fa-arrow-left"></i> Back to Student Database
                </a>
                <a href="../admin/check-in/index.html" class="back-link">
                    <i class="fas fa-arrow-left"></i> Back to Student Check In
                </a>
            </div>
        </div>
    </div>

    <!-- Terms and Conditions Modal -->
    <div id="terms-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-contract"></i> Terms and Conditions</h3>
                <button class="modal-close" id="terms-close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body terms-content">
                <h4>Urban Swing Terms and Conditions</h4>
                <p><strong>Last Updated: November 16, 2025</strong></p>
                
                <p><strong>Recent Changes:</strong></p>
                <p>November 16, 2025: Added Concession Payments and Single Class Booking Policy terms<br>
                January 10, 2025: Initial terms published</p>
                
                <h5>Liability Waiver & Acknowledgment of Risk</h5>
                <p>I understand that participating in dance classes, events, or activities at Urban Swing involves inherent risks, including but not limited to physical injury. While Urban Swing will take all reasonable precautions to ensure a safe environment and minimize these risks, I acknowledge that the ultimate responsibility for my safety lies with me as the participant.</p>
                
                <p>By participating in Urban Swing's classes or events, I agree to assume full responsibility for any injuries, accidents, or other incidents that may occur during my participation. I understand that Urban Swing cannot be held liable for any injuries or damages sustained while attending or engaging in its activities.</p>
                
                <p>I hereby release Urban Swing, its instructors, crew, and affiliates from any and all claims, demands, or causes of action related to injury, loss, or damage that may arise during my participation in classes or events.</p>
                
                <h5>Concession Payments</h5>
                <p>Concession purchases are non-refundable and non-transferable. Unused classes or credits will not be reimbursed or credited to another person.</p>
                
                <h5>Single Class Booking Policy</h5>
                <p>Payments for individual classes are non-refundable. However, you may request to reschedule your booked class to another date, provided the request is made before 7:00pm on the day of the class. Class changes after this time cannot be processed and your payment will be forfeited.</p>
                
                <h5>Media</h5>
                <p>By submitting this form, I give permission to Urban Swing Limited to capture photos, videos, and other media of my participation in dance classes, events, or performances. These images and videos may be used for advertising, educational, training, or other promotional purposes across various platforms, including social media, websites, and other digital media.</p>
                
                <p>I understand that my participation in media captured by Urban Swing may be shared publicly. However, if I have any concerns or would prefer not to be included in such media, I will inform an owner of Urban Swing upon my arrival at a class or event. Urban Swing respects my right to privacy and will make every effort to exclude me from media coverage if requested.</p>
                
                <p><strong>By submitting this form, I acknowledge that I fully understand and agree to these terms.</strong></p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="terms-accept-btn">
                    <i class="fas fa-check"></i> Accept and Close
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Config -->
    <script src="../config/firebase-config.js"></script>
    
    <!-- Stripe Config -->
    <script src="../config/stripe-config.js"></script>
    
    <!-- Date Picker Component -->
    <script src="../functions/date-picker/date-picker.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/firebase-init.js"></script>
    <script src="js/utils/password-generator.js"></script>
    <script src="js/services/auth-service.js"></script>
    <script src="js/services/student-service.js"></script>
    <script src="js/services/casual-rates-loader.js"></script>
    <script src="js/stripe/payment-handler.js"></script>
    <script src="js/ui/terms-modal.js"></script>
    <script src="js/ui/password-ui.js"></script>
    
    <!-- Registration Module Scripts -->
    <script src="js/registration/config.js"></script>
    <script src="js/registration/ui-helpers.js"></script>
    <script src="js/registration/validation.js"></script>
    <script src="js/registration/mode-setup.js"></script>
    <script src="js/registration/processors.js"></script>
    <script src="js/registration/form-handler.js"></script>
</body>
</html>
