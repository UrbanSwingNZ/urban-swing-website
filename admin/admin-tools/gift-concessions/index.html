<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Gift Concessions - Urban Swing Admin</title>
    <link rel="stylesheet" href="../../admin.css">
    <link rel="stylesheet" href="gift-concessions.css">
    <link rel="stylesheet" href="../../../styles/date-picker/date-picker.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="/images/icons/favicon.ico" type="image/x-icon">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="gift-concessions-container" class="dashboard-container">
        <header class="admin-header">
            <div class="admin-header-content">
                <a href="../index.html" class="back-button" title="Back to Admin Tools">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <h1 class="page-heading">
                    Gift Concessions
                </h1>
                <div class="admin-user-info">
                    <span id="user-email"></span>
                    <button id="logout-btn" class="btn-logout" title="Logout">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <main class="dashboard-main">
            <div class="gift-form-container">
                <form id="gift-form" class="gift-form">
                    <!-- Student Selection -->
                    <div class="form-section">
                        <h3><i class="fas fa-user"></i> Select Student</h3>
                        <div class="form-group">
                            <label for="student-search">Search by name or email</label>
                            <div class="search-input-wrapper">
                                <input 
                                    type="text" 
                                    id="student-search" 
                                    class="form-control" 
                                    placeholder="Search student name..."
                                    autocomplete="off"
                                    autocorrect="off"
                                    autocapitalize="off"
                                    spellcheck="false">
                                <button type="button" class="clear-search-btn" id="clear-student-search" style="display: none;">&times;</button>
                                <div id="student-results" class="search-results-dropdown" style="display: none;"></div>
                            </div>
                            <div id="selected-student-card" class="selected-student-card" style="display: none;">
                                <div class="student-info">
                                    <h4 id="selected-student-name"></h4>
                                    <p id="selected-student-email"></p>
                                    <p class="balance-info">
                                        Current Balance: <strong id="selected-student-balance">0</strong> classes
                                    </p>
                                </div>
                                <button type="button" class="btn-clear" onclick="clearSelectedStudent()" title="Clear selection">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Package Details -->
                    <div class="form-section">
                        <h3><i class="fas fa-ticket-alt"></i> Package Details</h3>
                        <div class="form-row form-row-three">
                            <div class="form-group">
                                <label for="gift-quantity">
                                    <i class="fas fa-hashtag"></i> Number of Classes
                                </label>
                                <input 
                                    type="number" 
                                    id="gift-quantity" 
                                    class="form-control" 
                                    min="1" 
                                    max="100" 
                                    placeholder="e.g., 5"
                                    required>
                            </div>

                            <div class="form-group">
                                <label for="gift-expiry">
                                    <i class="fas fa-calendar-alt"></i> Expiry Date
                                </label>
                                <div class="date-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="gift-expiry" 
                                        class="form-control" 
                                        readonly
                                        placeholder="Select expiry date"
                                        required>
                                    <i class="fas fa-calendar-alt date-input-icon"></i>
                                </div>
                                <div id="gift-expiry-calendar" class="custom-calendar" style="display: none;"></div>
                            </div>

                            <div class="form-group">
                                <label for="gift-date">
                                    <i class="fas fa-calendar-day"></i> Gift Date
                                </label>
                                <div class="date-input-wrapper">
                                    <input 
                                        type="text" 
                                        id="gift-date" 
                                        class="form-control" 
                                        readonly
                                        placeholder="Select gift date"
                                        required>
                                    <i class="fas fa-calendar-alt date-input-icon"></i>
                                </div>
                                <div id="gift-date-calendar" class="custom-calendar" style="display: none;"></div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="form-group">
                            <label for="gift-notes">
                                <i class="fas fa-sticky-note"></i> Reason / Notes
                            </label>
                            <textarea 
                                id="gift-notes" 
                                class="form-control" 
                                rows="3" 
                                placeholder="e.g., Scholarship award, Competition prize, Loyalty reward..."
                                required></textarea>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div class="form-section summary-section">
                        <h3><i class="fas fa-clipboard-check"></i> Summary</h3>
                        <div class="gift-summary">
                            <div class="summary-row">
                                <span>Student:</span>
                                <strong id="summary-student">-</strong>
                            </div>
                            <div class="summary-row">
                                <span>Classes to Gift:</span>
                                <strong id="summary-quantity">0</strong>
                            </div>
                            <div class="summary-row">
                                <span>New Balance:</span>
                                <strong id="summary-new-balance" class="balance-highlight">0</strong>
                            </div>
                            <div class="summary-row">
                                <span>Expires:</span>
                                <strong id="summary-expiry">-</strong>
                            </div>
                            <div class="summary-row">
                                <span>Reason:</span>
                                <strong id="summary-notes">-</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="resetForm()">
                            <i class="fas fa-redo"></i> Reset Form
                        </button>
                        <button type="submit" class="btn-primary" id="gift-submit-btn" disabled>
                            <i class="fas fa-gift"></i> Gift Concessions
                        </button>
                    </div>
                </form>
            </div>

            <!-- Recent Gifts -->
            <div class="recent-gifts-section">
                <h3><i class="fas fa-history"></i> Recent Gifts</h3>
                <div id="recent-gifts-list" class="recent-gifts-list">
                    <p class="loading-message"><i class="fas fa-spinner fa-spin"></i> Loading recent gifts...</p>
                </div>
            </div>
        </main>

        <footer class="admin-footer">
            <p>&copy; 2025 Urban Swing. Gift Concessions Tool v1.0</p>
        </footer>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3><i class="fas fa-gift"></i> Confirm Gift</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem;">Are you sure you want to gift these concessions?</p>
                <div class="confirm-details">
                    <div class="confirm-row">
                        <span>Student:</span>
                        <strong id="confirm-student-name"></strong>
                    </div>
                    <div class="confirm-row">
                        <span>Classes:</span>
                        <strong id="confirm-quantity"></strong>
                    </div>
                    <div class="confirm-row">
                        <span>Expiry Date:</span>
                        <strong id="confirm-expiry"></strong>
                    </div>
                    <div class="confirm-row">
                        <span>Reason:</span>
                        <strong id="confirm-notes"></strong>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeConfirmModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn-primary" id="confirm-gift-btn">
                    <i class="fas fa-check"></i> Yes, Gift Concessions
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3><i class="fas fa-check-circle"></i> Gift Successful!</h3>
            </div>
            <div class="modal-body">
                <div class="success-message" id="success-message-text">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" onclick="closeSuccessModal()">
                    <i class="fas fa-check"></i> Done
                </button>
                <button type="button" class="btn-secondary" onclick="closeSuccessModalAndReset()">
                    <i class="fas fa-gift"></i> Gift Another
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
        <p>Processing gift...</p>
    </div>

    <!-- Firebase Config & Scripts -->
    <script src="../../../config/firebase-config.js"></script>
    <script src="../../../functions/date-picker/date-picker.js"></script>
    <script src="../../concessions/js/concessions-data.js"></script>
    <script src="gift-concessions.js"></script>
</body>
</html>
