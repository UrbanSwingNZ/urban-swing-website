# Email Templates

This directory contains modularized email templates for the Urban Swing Firebase Functions.

## Structure

### `new-student-emails.js`
Contains email templates for new student registrations:

- **`generateAdminNotificationEmail(student, studentId, registeredAt, casualRate, studentRate, fiveClassPrice, tenClassPrice)`**
  - Generates admin notification email when a new student registers
  - Includes pricing table with all concession options
  - Conditionally shows pronouns, referral, and admin notes fields
  - Returns: `{ html, text }`
  - Used in: `sendNewStudentEmail` function

- **`generateWelcomeEmail(student, casualRate, studentRate, fiveClassPrice, tenClassPrice, hasUserAccount)`**
  - Generates welcome email for new students with class info and pricing
  - Conditionally shows portal account section based on hasUserAccount flag
  - Returns: `{ html, text }`
  - Used in: `sendNewStudentEmail` function

### `student-portal-setup-email.js`
Contains email template for existing students setting up portal accounts:

- **`generateAccountSetupEmail(student, user, setupDate)`**
  - Generates confirmation email when existing student creates portal account
  - Returns: `{ html, text }`
  - Used in: `sendAccountSetupEmail` function

### `error-notification-email.js`
Contains email template for system error notifications:

- **`generateErrorNotificationEmail(student, studentId, error)`**
  - Generates error notification for admin when email sending fails
  - Returns: `{ html, text }`
  - Used in: `sendNewStudentEmail` error handler

## Usage

Import the required email generators in `email-notifications.js`:

```javascript
const { generateAdminNotificationEmail, generateWelcomeEmail } = require('./emails/new-student-emails');
const { generateAccountSetupEmail } = require('./emails/student-portal-setup-email');
const { generateErrorNotificationEmail } = require('./emails/error-notification-email');
```

Generate email content:

```javascript
const adminEmail = generateAdminNotificationEmail(
  student, 
  studentId, 
  registeredAt,
  casualRate,
  studentRate,
  fiveClassPrice,
  tenClassPrice
);

const welcomeEmail = generateWelcomeEmail(
  student, 
  casualRate, 
  studentRate, 
  fiveClassPrice, 
  tenClassPrice,
  hasUserAccount
);
```

Use in nodemailer:

```javascript
await transporter.sendMail({
  from: '"Urban Swing" <dance@urbanswing.co.nz>',
  to: student.email,
  subject: "Welcome to Urban Swing! ðŸŽ‰",
  text: welcomeEmail.text,
  html: welcomeEmail.html,
});
```

## Benefits

- **Separation of Concerns**: Email templates are separate from business logic
- **Maintainability**: Easy to update email content without touching function code
- **Reusability**: Templates can be reused across different functions
- **Testing**: Templates can be tested independently
- **Readability**: Main function file is cleaner and easier to understand
- **Color Consistency**: All templates use color mappings that reference `styles/base/colors.css`
- **Verifiable**: HTML comments identify JS-generated emails for debugging

## Design System

All email templates include:
- **Color Mapping**: Each template has a `colors` object that maps to CSS custom properties in `styles/base/colors.css`
- **HTML Comments**: Templates include `<!-- Generated by JS: filename.js > functionName -->` for verification
- **Icon-based Footers**: Social media links use icons instead of text
- **Responsive Design**: Email-safe inline styles that work across email clients
- **Conditional Content**: Fields like pronouns, referral, and admin notes only display when present

## Email Types

1. **Admin Notification** - Sent to admin when new student registers (includes pricing table)
2. **Welcome Email** - Sent to new students with class info and pricing
3. **Account Setup** - Sent to existing students who create portal accounts
4. **Error Notification** - Sent to admin when email sending fails

### Password Reset Emails

Password reset emails are **not** handled by these JavaScript templates. They are sent directly by Firebase Authentication using `sendPasswordResetEmail()`. 

- **Location**: Firebase Console â†’ Authentication â†’ Templates â†’ Password reset
- **Customization**: Edit templates directly in Firebase Console
- **Why not JS?**: Firebase Auth sends these emails through its own infrastructure, not through Cloud Functions/nodemailer

A `password-reset` template existed in the Firestore email templates system but was never actually used, as it cannot be integrated with Firebase Auth's built-in password reset flow without building a complete custom authentication system.
